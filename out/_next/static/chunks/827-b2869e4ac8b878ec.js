(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[827],{28171:(e,t,n)=>{"use strict";n.d(t,{dj:()=>u});var r=n(12115);let a=0,o=new Map,s=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},i=[],l={toasts:[]};function d(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?s(n):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),i.forEach(e=>{e(l)})}function c(e){let t=(a=(a+1)%100).toString(),n=()=>d({type:"DISMISS_TOAST",toastId:t});return d({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||n()}}}),{id:t,dismiss:n,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function u(){let[e,t]=r.useState(l);return r.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},31584:e=>{e.exports={container:"input_container__pbC41"}},33789:(e,t,n)=>{"use strict";n.d(t,{p:()=>m});var r=n(3648),a=n(95155),o=n(12115),s=n(25016),i=n(53350),l=n(58415),d=n(60619),c=n(31584),u=n.n(c);function p(){let e=(0,r._)(["\n        radial-gradient(\n          "," circle at ","px ","px,\n          var(--dark-pink, #333333),\n          transparent 80%\n        )\n      "]);return p=function(){return e},e}let m=o.forwardRef((e,t)=>{let{className:n,type:r,...c}=e,[m,f]=o.useState(!1),h=(0,i.d)(0),g=(0,i.d)(0);return(0,a.jsx)(l.P.div,{style:{background:(0,d.E)(p(),m?"100px":"0px",h,g)},onMouseMove:function(e){let{currentTarget:t,clientX:n,clientY:r}=e,{left:a,top:o}=t.getBoundingClientRect();h.set(n-a),g.set(r-o)},onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),className:(0,s.cn)(u().container,"group/input"),children:(0,a.jsx)("input",{type:r,className:(0,s.cn)("flex h-10 w-full rounded-md border border-neutral-800 bg-neutral-950 px-3 py-2 text-sm file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...c})})});m.displayName="Input"},35234:e=>{e.exports={weekNumber:"calendar_weekNumber__sXaMA"}},39783:e=>{e.exports={content:"tooltip_content__FEo1X",enter:"tooltip_enter__iOTtG","fade-in":"tooltip_fade-in__1h2s_"}},41888:e=>{e.exports={header:"client-providers_header__EoOrl",title:"client-providers_title__7QmDq"}},52680:(e,t,n)=>{"use strict";n.d(t,{LayoutProvider:()=>s,g:()=>i});var r=n(95155),a=n(12115);let o=(0,a.createContext)(void 0);function s(e){let{children:t}=e,[n,s]=(0,a.useState)("two-row");return(0,r.jsx)(o.Provider,{value:{layout:n,setLayout:s,toggleLayout:()=>{s(e=>"two-row"===e?"single-row":"two-row")}},children:t})}function i(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useLayout must be used within a LayoutProvider");return e}},55725:(e,t,n)=>{"use strict";n.d(t,{V:()=>u});var r=n(95155),a=n(12115),o=n(74854),s=n(6372),i=n(25016),l=n(97003),d=n(35234),c=n.n(d);function u(e){let{className:t,classNames:n,showOutsideDays:a=!0,captionLayout:d="label",buttonVariant:u="ghost-icon",formatters:m,components:f,...h}=e,g=(0,o.a)();return(0,r.jsx)(s.h,{showOutsideDays:a,className:(0,i.cn)("bg-[#1a1a1a] border border-[#252525] group/calendar p-4 rounded-lg [--cell-size:2.5rem] text-white",t),captionLayout:d,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...m},classNames:{root:(0,i.cn)("w-fit",g.root),months:(0,i.cn)("relative flex flex-col gap-4 md:flex-row",g.months),month:(0,i.cn)("flex w-full flex-col gap-4",g.month),nav:(0,i.cn)("absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1 pb-2",g.nav),button_previous:(0,i.cn)((0,l.r)({variant:u}),"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50 text-white",g.button_previous),button_next:(0,i.cn)((0,l.r)({variant:u}),"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50 text-white",g.button_next),month_caption:(0,i.cn)("flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]",g.month_caption),dropdowns:(0,i.cn)("flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium text-white",g.dropdowns),dropdown_root:(0,i.cn)("has-focus:border-[#8c8c8c] border-[#252525] bg-[#252525] shadow-xs has-focus:ring-[#8c8c8c]/50 has-focus:ring-[3px] relative rounded-md border text-white",g.dropdown_root),dropdown:(0,i.cn)("absolute inset-0 opacity-0",g.dropdown),caption_label:(0,i.cn)("select-none font-medium text-white","label"===d?"text-sm":"[&>svg]:text-[#8c8c8c] flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5",g.caption_label),table:"w-full border-collapse",weekdays:(0,i.cn)("flex",g.weekdays),weekday:(0,i.cn)("text-[#8c8c8c] flex-1 select-none rounded-md text-[0.8rem] font-normal",g.weekday),week:(0,i.cn)("mt-2 flex w-full",g.week),week_number_header:(0,i.cn)("w-[--cell-size] select-none text-[#8c8c8c]",g.week_number_header),week_number:(0,i.cn)("text-[#8c8c8c] select-none text-[0.8rem]",g.week_number),day:(0,i.cn)("group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md",g.day),range_start:(0,i.cn)("bg-[#252525] rounded-l-md",g.range_start),range_middle:(0,i.cn)("bg-[#252525]/50 rounded-none",g.range_middle),range_end:(0,i.cn)("bg-[#252525] rounded-r-md",g.range_end),today:(0,i.cn)("bg-[#2d2d2d] text-white rounded-md data-[selected=true]:rounded-none border border-[#8c8c8c]/30",g.today),outside:(0,i.cn)("text-[#8c8c8c]/50 aria-selected:text-[#8c8c8c]/50",g.outside),disabled:(0,i.cn)("text-[#8c8c8c]/30 opacity-50",g.disabled),hidden:(0,i.cn)("invisible",g.hidden),...n},components:{Root:e=>{let{className:t,rootRef:n,...a}=e;return(0,r.jsx)("div",{"data-slot":"calendar",ref:n,className:(0,i.cn)(t),...a})},Chevron:e=>{let{className:t,orientation:n,...a}=e;return(0,r.jsx)("span",{className:(0,i.cn)("size-4 text-white",t),...a,children:"â€¢"})},DayButton:p,WeekNumber:e=>{let{children:t,...n}=e;return(0,r.jsx)("td",{...n,children:(0,r.jsx)("div",{className:c().weekNumber,children:t})})},...f},...h})}function p(e){let{className:t,day:n,modifiers:s,...d}=e,c=(0,o.a)(),u=a.useRef(null);return a.useEffect(()=>{var e;s.focused&&(null==(e=u.current)||e.focus())},[s.focused]),(0,r.jsx)(l.$,{ref:u,variant:"ghost",size:"icon","data-day":n.date.toLocaleDateString(),"data-selected-single":s.selected&&!s.range_start&&!s.range_end&&!s.range_middle,"data-range-start":s.range_start,"data-range-end":s.range_end,"data-range-middle":s.range_middle,className:(0,i.cn)("data-[selected-single=true]:bg-white data-[selected-single=true]:text-black data-[range-middle=true]:bg-[#252525] data-[range-middle=true]:text-white data-[range-start=true]:bg-white data-[range-start=true]:text-black data-[range-end=true]:bg-white data-[range-end=true]:text-black group-data-[focused=true]/day:border-[#8c8c8c] group-data-[focused=true]/day:ring-[#8c8c8c]/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70 text-white hover:bg-[#252525] hover:text-white transition-colors",c.day,t),...d})}},59026:(e,t,n)=>{"use strict";n.d(t,{A:()=>C,e:()=>S});var r=n(95155),a=n(12115),o=n(14888),s=n(67909),i=n(65920),l=n(97450),d=n(71163),c=n(55725),u=n(23109),p=n(80853);n(50429),n(11200);let m=(0,a.memo)(function(e){let{initialContent:t=[],onChange:n,placeholder:o="Describe the task...",className:s,style:i,readOnly:l=!1}=e,d=(0,a.useRef)(null),c=(0,a.useRef)(""),m=(0,a.useRef)(!1),f=(0,u.Hx)({initialContent:t.length>0?t:[{id:"initial",type:"paragraph",content:[]}],domAttributes:{editor:{class:"task-editor-content"}}});return(0,a.useEffect)(()=>{m.current||(c.current=JSON.stringify(t||[]),m.current=!0)},[t]),(0,a.useEffect)(()=>{let e;if(n){try{let t=f.onEditorContentChange(()=>{d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{let e=JSON.stringify(f.document||[]);e!==c.current&&(c.current=e,n(f.document))},300)});"function"==typeof t&&(e=t)}catch(e){console.warn("Content change handler setup error:",e)}return()=>{d.current&&(clearTimeout(d.current),d.current=null),"function"==typeof e&&e()}}},[f,n]),(0,r.jsxs)("div",{className:"task-editor-wrapper ".concat(s||""),style:i,children:[(0,r.jsx)("style",{dangerouslySetInnerHTML:{__html:'\n          .task-editor-wrapper {\n            border-radius: var(--md-sys-shape-corner-extra-small);\n            overflow: hidden;\n            min-height: 80px;\n            background-color: transparent;\n          }\n          \n          .task-editor-wrapper .bn-container {\n            background-color: transparent !important;\n            border: none !important;\n            color: var(--md-sys-color-on-surface) !important;\n            min-height: 80px !important;\n          }\n          \n          .task-editor-wrapper .bn-editor {\n            padding: 10px !important;\n            min-height: 80px !important;\n            box-sizing: border-box !important;\n          }\n          \n          .task-editor-wrapper .task-editor-content {\n            min-height: 56px !important;\n          }\n          \n          .task-editor-wrapper [data-node-type="paragraph"] {\n            font-size: 14px !important;\n            line-height: 20px !important;\n            font-family: var(--md-sys-typescale-body-large-font) !important;\n            color: var(--md-sys-color-on-surface) !important;\n            margin: 0 !important;\n            padding: 2px 0 !important;\n          }\n          \n          .task-editor-wrapper .ProseMirror p.is-editor-empty:first-child::before {\n            content: "'.concat(o,"\";\n            color: var(--md-sys-color-on-surface-variant);\n            float: left;\n            pointer-events: none;\n            height: 0;\n            font-size: 14px;\n            line-height: 20px;\n            font-family: var(--md-sys-typescale-body-large-font);\n          }\n          \n          .task-editor-wrapper .ProseMirror {\n            outline: none !important;\n            padding: 0 !important;\n            margin: 0 !important;\n            min-height: 56px !important;\n          }\n          \n          .task-editor-wrapper .ProseMirror ::selection {\n            background: rgba(187, 134, 252, 0.3) !important;\n          }\n          \n          .task-editor-wrapper .ProseMirror:focus {\n            outline: none !important;\n          }\n          \n          /* Hide all toolbars and menus for task editor */\n          .task-editor-wrapper .bn-formatting-toolbar,\n          .task-editor-wrapper .bn-suggestion-menu,\n          .task-editor-wrapper .bn-side-menu {\n            display: none !important;\n          }\n          \n          /* Style text formatting within task editor */\n          .task-editor-wrapper strong {\n            font-weight: 600 !important;\n            color: var(--md-sys-color-on-surface) !important;\n          }\n          \n          .task-editor-wrapper em {\n            font-style: italic !important;\n            color: var(--md-sys-color-on-surface) !important;\n          }\n          \n          .task-editor-wrapper code {\n            background-color: var(--md-sys-color-surface-container-highest) !important;\n            color: var(--md-sys-color-primary) !important;\n            padding: 2px 4px !important;\n            border-radius: 4px !important;\n            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace !important;\n            font-size: 0.9em !important;\n          }\n        ")}}),(0,r.jsx)(p.NP,{editor:f,editable:!0,theme:"dark",sideMenu:!1,formattingToolbar:!1,slashMenu:!1,className:"task-editor-view"})]})});var f=n(54879),h=n(22544),g=n(33602);async function y(e){console.log("updateTaskAPI called with:",e);let t=await fetch("/api/tasks/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("Update API response status:",t.status),!t.ok)throw console.error("Update API error response:",await t.json()),Error("Failed to update task");let n=await t.json();return console.log("Update API success response:",n),n.data}async function x(e){console.log("createTaskAPI called with:",e);let t=await fetch("/api/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("API response status:",t.status),!t.ok){let e=await t.json();throw console.error("API error response:",e),Error(e.error||"Failed to create task")}let n=await t.json();return console.log("API success response:",n),n.data}(0,s.default)(()=>Promise.all([n.e(16),n.e(286),n.e(259),n.e(670),n.e(96),n.e(208),n.e(228)]).then(n.bind(n,72228)).then(e=>e.Editor),{loadableGenerated:{webpack:()=>[72228]},ssr:!1,loading:()=>(0,r.jsx)("p",{children:"Loading editor..."})});let w=f.Ik({title:f.Yj().min(1,"Title is required"),content:i.gx.optional(),isCompleted:f.zM().default(!1),isHighPriority:f.zM().default(!1),dueDate:f.p6().optional().nullable()});function _(e){let{task:t,onClose:n,onSave:o,initialDescription:s=""}=e,[u,p]=(0,a.useTransition)(),[f,_]=(0,a.useState)(null),[b,v]=(0,a.useState)(!1),k=(null==t?void 0:t.content)||(s?[{type:"paragraph",content:[{type:"text",text:s}]}]:i.MG),[N,S]=(0,a.useState)(JSON.parse(JSON.stringify(k))),C=()=>{if(null==t?void 0:t.title)return t.title;if(s){let e=s.split("\n")[0];return e.length>50?e.substring(0,50)+"...":e}return""},I=(0,h.mN)({resolver:(0,g.u)(w),defaultValues:{title:C(),content:k,isCompleted:(null==t?void 0:t.isCompleted)||!1,isHighPriority:(null==t?void 0:t.isHighPriority)||!1,dueDate:(null==t?void 0:t.dueDate)||null}});(0,a.useEffect)(()=>{t?(I.reset({title:t.title,content:t.content||i.MG,isCompleted:t.isCompleted,isHighPriority:t.isHighPriority,dueDate:t.dueDate||null}),S(JSON.parse(JSON.stringify(t.content||i.MG)))):s&&I.reset({title:C(),content:k,isCompleted:!1,isHighPriority:!1,dueDate:null})},[t,s,I,k]),(0,a.useEffect)(()=>{var e,n;(null==f||null==(e=f.data)?void 0:e.success)&&!t?null==o||o():(null==f||null==(n=f.data)?void 0:n.error)&&console.error("Server error:",f.data.error)},[f,o,t]);let j=()=>{I.formState.isDirty?(console.log("Form is dirty, submitting:",I.getValues()),E(I.getValues())):console.log("Form not dirty, skipping submit")},E=async e=>{console.log("onSubmit called with values:",e),console.log("currentContent:",N);let n={title:e.title||"",content:N,isCompleted:e.isCompleted||!1,isHighPriority:e.isHighPriority||!1,dueDate:e.dueDate||null,order:(null==t?void 0:t.order)||null};console.log("dataToSend:",n),p(async()=>{try{let e;(null==t?void 0:t.id)?(console.log("Updating existing task:",t.id),e=await y({id:t.id,...n})):(console.log("Creating new task"),e=await x(n)),console.log("Save result:",e),_({data:{success:!0,data:e}})}catch(e){console.error("Failed to save task:",e),_({data:{success:!1,error:e.message}})}})};return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"flex-1 overflow-auto p-6",children:(0,r.jsxs)("form",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"md3-text-field md3-text-field--with-label",children:(0,r.jsxs)("div",{className:"md3-text-field__container",children:[(0,r.jsx)("input",{id:"title",...I.register("title"),placeholder:" ",className:"md3-text-field__input",onBlur:j}),(0,r.jsx)("label",{htmlFor:"title",className:"md3-text-field__label",children:"Task Title"})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"md3-text-field md3-text-field--with-label flex-shrink-0",style:{width:"120px"},children:(0,r.jsxs)("div",{className:"md3-text-field__container relative",children:[(0,r.jsxs)(l.AM,{open:b,onOpenChange:v,children:[(0,r.jsx)(l.Wv,{asChild:!0,children:(0,r.jsx)("input",{readOnly:!0,value:I.watch("dueDate")?(0,d.GP)(I.watch("dueDate"),"dd/MM/yyyy"):"",className:"md3-text-field__input cursor-pointer pr-8",placeholder:" "})}),(0,r.jsxs)(l.hl,{className:"w-auto p-0 rounded-lg md3-elevation-3",style:{backgroundColor:"var(--md-sys-color-surface-container-high)",border:"1px solid var(--md-sys-color-outline)"},onOpenAutoFocus:e=>e.preventDefault(),onClick:e=>e.stopPropagation(),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,r.jsx)(c.V,{mode:"single",selected:I.watch("dueDate")||void 0,onSelect:e=>{I.setValue("dueDate",e||null,{shouldDirty:!0}),j(),v(!1)},className:"rounded-md",initialFocus:!0}),I.watch("dueDate")&&(0,r.jsx)("div",{className:"p-2 border-t border-[var(--md-sys-color-outline)]",children:(0,r.jsx)("button",{type:"button",onClick:()=>{I.setValue("dueDate",null,{shouldDirty:!0}),j(),v(!1)},className:"w-full text-sm text-red-400 hover:text-red-300 py-1",children:"Remove date"})})]})]}),I.watch("dueDate")&&(0,r.jsx)("button",{type:"button",onClick:()=>{I.setValue("dueDate",null,{shouldDirty:!0}),j()},className:"absolute right-2 top-1/2 -translate-y-1/2 text-white/40 hover:text-white/40 p-1",children:(0,r.jsx)("span",{size:16,children:"\xd7"})}),(0,r.jsx)("label",{htmlFor:"dueDate",className:"md3-text-field__label",children:"Due by (optional)"})]})}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 flex-shrink-0",style:{width:"fit-content"},children:[(0,r.jsx)("div",{className:"md3-switch ".concat(I.watch("isHighPriority")?"md3-switch--checked":""),onClick:()=>{let e=!I.watch("isHighPriority");I.setValue("isHighPriority",e,{shouldDirty:!0}),j()},children:(0,r.jsx)("div",{className:"md3-switch__thumb"})}),(0,r.jsx)("label",{className:"md3-on-surface-variant cursor-pointer whitespace-nowrap text-sm",onClick:()=>{let e=!I.watch("isHighPriority");I.setValue("isHighPriority",e,{shouldDirty:!0}),j()},children:"High Priority"})]})]}),(0,r.jsx)("div",{className:"md3-text-field md3-text-field--with-label",children:(0,r.jsxs)("div",{className:"md3-text-field__container relative",children:[(0,r.jsx)(m,{initialContent:N,onChange:e=>{console.log("Editor content changed:",e),S(e),I.setValue("content",e,{shouldDirty:!0}),j()},placeholder:"Describe the task...",className:"task-description-editor md3-text-field__input",style:{border:"1px solid var(--md-sys-color-outline)",borderRadius:"var(--md-sys-shape-corner-extra-small)",minHeight:"80px",padding:"0"}}),(0,r.jsx)("label",{className:"md3-text-field__label",children:"Description"})]})}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 pb-4",children:[(0,r.jsx)("div",{className:"md3-checkbox ".concat(I.watch("isCompleted")?"md3-checkbox--checked":""),onClick:()=>{let e=!I.watch("isCompleted");I.setValue("isCompleted",e,{shouldDirty:!0}),j()},children:I.watch("isCompleted")&&(0,r.jsx)("svg",{className:"md3-checkbox__checkmark",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:(0,r.jsx)("polyline",{points:"20,6 9,17 4,12"})})}),(0,r.jsx)("label",{className:"md3-on-surface-variant cursor-pointer text-sm",onClick:()=>{let e=!I.watch("isCompleted");I.setValue("isCompleted",e,{shouldDirty:!0}),j()},children:"Mark as Complete"})]})]})}),(0,r.jsx)("div",{className:"p-4 border-t border-[var(--md-sys-color-outline)]",children:(0,r.jsx)("button",{type:"button",onClick:n,className:"md3-button md3-button--filled w-full",children:"Done"})})]})}var b=n(99776),v=n(41888),k=n.n(v);let N=(0,a.createContext)(void 0);function S(){let e=(0,a.useContext)(N);if(void 0===e)throw Error("useTaskModal must be used within a TaskModalProvider");return e}function C(e){let{children:t}=e,n=(0,b.jE)(),[s,i]=(0,a.useState)(null),[l,d]=(0,a.useState)(null),c=n.getQueryData(["tasks"]),u=(0,a.useMemo)(()=>s&&c?c.find(e=>e.id===s):null,[s,c]),p=()=>{i(null),d(null)},m=(0,a.useMemo)(()=>({setActiveTaskId:i,setNewTaskText:d,activeTask:u}),[i,d,u]);return(0,r.jsxs)(N.Provider,{value:m,children:[t,(0,r.jsx)(o._s,{open:!!(s||l),onOpenChange:e=>{e||p()},direction:"right",children:(0,r.jsxs)(o.zj,{direction:"right",className:"overflow-hidden",children:[(0,r.jsxs)("div",{className:k().header,children:[(0,r.jsx)("h2",{className:k().title,children:(null==u?void 0:u.id)?"Edit Task":"Create Task"}),(0,r.jsx)(o.cp,{asChild:!0,children:(0,r.jsx)("button",{className:"md3-icon-button","aria-label":"Close dialog",children:(0,r.jsx)("span",{size:20,children:"\xd7"})})})]}),(0,r.jsx)(_,{task:u,onClose:p,onSave:()=>{p(),n.invalidateQueries({queryKey:["tasks"]})},initialDescription:l||void 0})]})})]})}},65920:(e,t,n)=>{"use strict";n.d(t,{MG:()=>H,gx:()=>J});var r=n(3648),a=n(5591),o=n(67101),s=n(80857),i=n(97930),l=n(16446),d=n(7300),c=n(12808),u=n(22107),p=n(878),m=n(88546),f=n(82575),h=n(45993),g=n(54879),y=n(12634);function x(){let e=(0,r._)(["auth.uid() = ",""]);return x=function(){return e},e}function w(){let e=(0,r._)(["auth.uid() = ",""]);return w=function(){return e},e}function _(){let e=(0,r._)(["auth.uid() = ",""]);return _=function(){return e},e}function b(){let e=(0,r._)(["auth.uid() = ",""]);return b=function(){return e},e}function v(){let e=(0,r._)(["auth.uid() = ",""]);return v=function(){return e},e}function k(){let e=(0,r._)(["auth.uid() = ",""]);return k=function(){return e},e}function N(){let e=(0,r._)(["auth.uid() = ",""]);return N=function(){return e},e}function S(){let e=(0,r._)(["auth.uid() = ",""]);return S=function(){return e},e}function C(){let e=(0,r._)(["auth.uid() = ",""]);return C=function(){return e},e}function I(){let e=(0,r._)(["auth.uid() = ",""]);return I=function(){return e},e}function j(){let e=(0,r._)(["auth.uid() = ",""]);return j=function(){return e},e}function E(){let e=(0,r._)(["auth.uid() = ",""]);return E=function(){return e},e}function D(){let e=(0,r._)(["auth.uid() = ",""]);return D=function(){return e},e}function A(){let e=(0,r._)(["auth.uid() = ",""]);return A=function(){return e},e}function T(){let e=(0,r._)(["auth.uid() = ",""]);return T=function(){return e},e}function R(){let e=(0,r._)(["auth.uid() = ",""]);return R=function(){return e},e}function q(){let e=(0,r._)(["auth.uid() = ",""]);return q=function(){return e},e}function Q(){let e=(0,r._)(["auth.uid() = ",""]);return Q=function(){return e},e}function M(){let e=(0,r._)(["auth.uid() = ",""]);return M=function(){return e},e}function P(){let e=(0,r._)(["auth.uid() = ",""]);return P=function(){return e},e}function O(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}let z=g.Ik({type:g.eu("text"),text:g.Yj(),styles:g.g1(g.bz()).optional()}),L=g.g1(g.bz()),F=g.RZ(()=>g.Ik({id:g.Yj(),type:g.Yj(),props:L.optional(),content:g.YO(g.KC([z,g.RZ(()=>F)])).optional(),children:g.YO(g.Yj()).optional(),data:g.g1(g.bz()).optional()})),J=g.YO(F),H=[{id:"default-paragraph",type:"paragraph",content:[],props:{}}],K=(0,a.cJ)("user",{id:(0,o.uR)("id").primaryKey().$defaultFn(()=>O()),name:(0,s.Qq)("name"),email:(0,s.Qq)("email").notNull(),emailVerified:(0,i.vE)("emailVerified",{mode:"date"}),image:(0,s.Qq)("image"),password:(0,s.Qq)("password"),googleId:(0,s.Qq)("google_id").unique(),accessToken:(0,s.Qq)("access_token"),refreshToken:(0,s.Qq)("refresh_token"),tokenExpiry:(0,i.vE)("token_expiry",{mode:"date"}),googleCalendarConnected:(0,l.zM)("google_calendar_connected").default(!1),lastCalendarSync:(0,i.vE)("last_calendar_sync",{mode:"date"}),createdAt:(0,i.vE)("created_at").defaultNow().notNull(),updatedAt:(0,i.vE)("updated_at").defaultNow().notNull()},e=>({rls:(0,d.g)("user RLS policy",{using:(0,h.ll)(x(),e.id),withCheck:(0,h.ll)(w(),e.id),to:y.w7,for:"all"})})).enableRLS();(0,a.cJ)("account",{userId:(0,o.uR)("userId").notNull().references(()=>K.id,{onDelete:"cascade"}),provider:(0,s.Qq)("provider").notNull(),providerAccountId:(0,s.Qq)("providerAccountId").notNull(),refresh_token:(0,s.Qq)("refresh_token"),access_token:(0,s.Qq)("access_token"),expires_at:(0,c.nd)("expires_at"),token_type:(0,s.Qq)("token_type"),scope:(0,s.Qq)("scope"),id_token:(0,s.Qq)("id_token"),session_state:(0,s.Qq)("session_state")},e=>({compoundKey:(0,u.ie)({columns:[e.provider,e.providerAccountId]}),rls:(0,d.g)("account RLS policy",{using:(0,h.ll)(_(),e.userId),withCheck:(0,h.ll)(b(),e.userId),to:y.w7,for:"all"})})).enableRLS(),(0,a.cJ)("session",{sessionToken:(0,s.Qq)("sessionToken").notNull().primaryKey(),userId:(0,o.uR)("userId").notNull().references(()=>K.id,{onDelete:"cascade"}),expires:(0,i.vE)("expires",{mode:"date"}).notNull()},e=>({rls:(0,d.g)("session RLS policy",{using:(0,h.ll)(v(),e.userId),withCheck:(0,h.ll)(k(),e.userId),to:y.w7,for:"all"})})).enableRLS(),(0,a.cJ)("verification_tokens",{identifier:(0,s.Qq)("identifier").notNull(),token:(0,s.Qq)("token").notNull(),expires:(0,i.vE)("expires",{mode:"date"}).notNull()},e=>({compoundKey:(0,u.ie)({columns:[e.identifier,e.token]})}));let U=(0,a.cJ)("connected_accounts",{id:(0,o.uR)("id").primaryKey().$defaultFn(()=>O()),userId:(0,o.uR)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),provider:(0,s.Qq)("provider").notNull(),providerAccountId:(0,s.Qq)("provider_account_id").notNull(),accessToken:(0,s.Qq)("access_token"),refreshToken:(0,s.Qq)("refresh_token"),tokenExpiry:(0,i.vE)("token_expiry",{mode:"date"}),createdAt:(0,i.vE)("created_at").defaultNow().notNull(),updatedAt:(0,i.vE)("updated_at").defaultNow().notNull().$onUpdate(()=>new Date)},e=>({providerAccount:(0,p.GL)("connected_accounts_provider_account_id_unique").on(e.provider,e.providerAccountId),userIdIndex:(0,p.Pe)("connected_accounts_user_id_index").on(e.userId)})).enableRLS();(0,a.cJ)("user_calendars",{id:(0,o.uR)("id").primaryKey().$defaultFn(()=>O()),userId:(0,o.uR)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),connectedAccountId:(0,o.uR)("connected_account_id").notNull().references(()=>U.id,{onDelete:"cascade"}),calendarId:(0,s.Qq)("calendar_id").notNull(),name:(0,s.Qq)("name").notNull(),color:(0,s.Qq)("color"),isEnabled:(0,l.zM)("is_enabled").default(!0).notNull(),accessRole:(0,s.Qq)("access_role"),createdAt:(0,i.vE)("created_at").defaultNow().notNull(),updatedAt:(0,i.vE)("updated_at").defaultNow().notNull().$onUpdate(()=>new Date)},e=>({calendarUnique:(0,p.GL)("user_calendars_unique_calendar").on(e.connectedAccountId,e.calendarId),userIdIndex:(0,p.Pe)("user_calendars_user_id_index").on(e.userId)})).enableRLS(),(0,a.cJ)("notes",{id:(0,o.uR)("id").primaryKey().$defaultFn(()=>O()),userId:(0,o.uR)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),title:(0,s.Qq)("title").notNull(),content:(0,m.Fx)("content").$default(()=>[]),createdAt:(0,i.vE)("created_at").defaultNow().notNull(),updatedAt:(0,i.vE)("updated_at").defaultNow().notNull().$onUpdate(()=>new Date)},e=>({rls:(0,d.g)("notes RLS policy",{using:(0,h.ll)(N(),e.userId),withCheck:(0,h.ll)(S(),e.userId),to:y.w7,for:"all"})})).enableRLS(),(0,a.cJ)("tasks",{id:(0,o.uR)("id").primaryKey().$defaultFn(()=>O()),userId:(0,o.uR)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),title:(0,s.Qq)("title").notNull(),content:(0,m.Fx)("content").default(H).$type().notNull(),isCompleted:(0,l.zM)("is_completed").default(!1).notNull(),isHighPriority:(0,l.zM)("is_high_priority").default(!1).notNull(),dueDate:(0,i.vE)("due_date",{mode:"date"}),order:(0,c.nd)("order"),createdAt:(0,i.vE)("created_at").defaultNow().notNull(),updatedAt:(0,i.vE)("updated_at").defaultNow().notNull().$onUpdate(()=>new Date)},e=>({rls:(0,d.g)("tasks RLS policy",{using:(0,h.ll)(C(),e.userId),withCheck:(0,h.ll)(I(),e.userId),to:y.w7,for:"all"})})).enableRLS(),(0,a.cJ)("user_preferences",{id:(0,o.uR)("id").primaryKey().$defaultFn(()=>O()),userId:(0,o.uR)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}).unique(),agentName:(0,s.Qq)("agent_name").notNull().default("Alex"),userName:(0,s.Qq)("user_name").notNull().default("User"),initialized:(0,l.zM)("initialized").default(!1).notNull(),countdownTitle:(0,s.Qq)("countdown_title").default("Countdown"),countdownMode:(0,f.yf)("countdown_mode",{enum:["date-range","manual-count"]}).default("date-range"),paydayDate:(0,i.vE)("payday_date",{mode:"date"}),paydayFrequency:(0,f.yf)("payday_frequency",{enum:["weekly","fortnightly","monthly","annual","none"]}).default("fortnightly"),startDate:(0,i.vE)("start_date",{mode:"date"}),endDate:(0,i.vE)("end_date",{mode:"date"}),manualCount:(0,c.nd)("manual_count").default(0),salary:(0,c.nd)("salary").default(0),expenses:(0,c.nd)("expenses").default(2e3),location:(0,s.Qq)("location").default("San Francisco, CA"),openaiApiKey:(0,s.Qq)("openai_api_key"),theme:(0,s.Qq)("theme").default("dark"),currency:(0,s.Qq)("currency").default("USD")},e=>({rls:(0,d.g)("user_preferences RLS policy",{using:(0,h.ll)(j(),e.userId),withCheck:(0,h.ll)(E(),e.userId),to:y.w7,for:"all"})})).enableRLS(),(0,a.cJ)("chat_messages",{id:(0,o.uR)("id").primaryKey().$defaultFn(()=>O()),userId:(0,o.uR)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),message:(0,s.Qq)("message").notNull(),role:(0,s.Qq)("role").notNull(),sessionId:(0,s.Qq)("session_id"),createdAt:(0,i.vE)("created_at").defaultNow().notNull(),expiresAt:(0,i.vE)("expires_at").notNull()},e=>({rls:(0,d.g)("chat_messages RLS policy",{using:(0,h.ll)(D(),e.userId),withCheck:(0,h.ll)(A(),e.userId),to:y.w7,for:"all"})})).enableRLS(),(0,a.cJ)("emotional_metadata",{id:(0,o.uR)("id").primaryKey().$defaultFn(()=>O()),userId:(0,o.uR)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),sourceType:(0,s.Qq)("source_type").notNull(),sourceId:(0,o.uR)("source_id"),emotion:(0,s.Qq)("emotion").notNull(),tone:(0,s.Qq)("tone").notNull(),intent:(0,s.Qq)("intent").notNull(),confidence:(0,c.nd)("confidence").notNull(),insights:(0,s.Qq)("insights"),suggestedActions:(0,s.Qq)("suggested_actions").array(),mem0MemoryId:(0,s.Qq)("mem0_memory_id"),createdAt:(0,i.vE)("created_at").defaultNow().notNull()},e=>({rls:(0,d.g)("emotional_metadata RLS policy",{using:(0,h.ll)(T(),e.userId),withCheck:(0,h.ll)(R(),e.userId),to:y.w7,for:"all"})})).enableRLS(),(0,a.cJ)("memory_usage",{id:(0,o.uR)("id").primaryKey().$defaultFn(()=>O()),userId:(0,o.uR)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),timestamp:(0,i.vE)("timestamp").defaultNow().notNull(),totalTokens:(0,c.nd)("total_tokens").notNull(),totalCost:(0,s.Qq)("total_cost").notNull()},e=>({rls:(0,d.g)("memory_usage RLS policy",{using:(0,h.ll)(q(),e.userId),withCheck:(0,h.ll)(Q(),e.userId),to:y.w7,for:"all"})})).enableRLS(),(0,a.cJ)("memories",{id:(0,o.uR)("id").primaryKey().$defaultFn(()=>O()),userId:(0,o.uR)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),memoryVector:(0,s.Qq)("memory_vector").notNull(),summary:(0,s.Qq)("summary").notNull(),type:(0,s.Qq)("type").notNull(),createdAt:(0,i.vE)("created_at").defaultNow().notNull()},e=>({rls:(0,d.g)("memories RLS policy",{using:(0,h.ll)(M(),e.userId),withCheck:(0,h.ll)(P(),e.userId),to:y.w7,for:"all"})})).enableRLS()},67888:(e,t,n)=>{"use strict";n.d(t,{I:()=>l});var r=n(95155);n(12115);var a=n(99486),o=n(58415),s=n(88219),i=n.n(s);function l(e){let{onClick:t,className:n,layoutId:s}=e;return(0,r.jsxs)(o.P.div,{layoutId:s,onClick:t,className:"".concat(i().container," ").concat(n),transition:{type:"spring",damping:30,stiffness:200,mass:.7},children:[(0,r.jsx)("button",{className:"shiny-cta absolute inset-0"}),(0,r.jsx)("div",{className:i().iconContainer,children:(0,r.jsx)(a.GL,{src:"https://lottie.host/5368e488-cb9d-4667-b407-8b42472d4c6e/0QAbp6DRx3.lottie",loop:!0,autoplay:!0,speed:.5,style:{width:"100%",height:"100%",lineHeight:0,aspectRatio:"421 / 233",left:"0",position:"relative"}})})]})}},69452:(e,t,n)=>{"use strict";n.d(t,{k:()=>u,v:()=>p});var r=n(95155),a=n(12115);let o=async(e,t,n,r,a)=>({success:!0,data:{response:"AI features require web app. Please use the full web version for AI chat.",onboardingStep:t?void 0:1},serverError:null});var s=n(97113),i=n(28171),l=n(99776),d=n(80549);let c=(0,a.createContext)(void 0);function u(e){let{children:t}=e,[n,u]=(0,a.useState)(!1),[p,m]=(0,a.useState)([]),[f,h]=(0,a.useState)(!1),[g,y]=(0,a.useState)(""),[x,w]=(0,a.useState)(""),[_,b]=(0,a.useState)(!0),v=(0,a.useRef)(null),{hasSeenOnboarding:k,onboardingStep:N,setOnboardingStep:S,completeOnboarding:C,userName:I,agentName:j}=(0,s.t)(),{toast:E}=(0,i.dj)(),D=(0,l.jE)(),A=(0,d.n)({mutationFn:async e=>{let t=e.trim();if(!t||t.length<5)throw Error("Task content must be at least 5 characters");if(!/\s/.test(t)&&t.length<10)throw Error("Task content appears to be too short or a single word");console.log("Creating task with content:",e),console.trace("Task creation stack trace:");let n=await fetch("/api/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e.trim()})});if(!n.ok)throw Error("Failed to create task");return n.json()},onSuccess:()=>{D.invalidateQueries({queryKey:["tasks"]}),E({title:"Task created",description:"Your task has been created successfully."})},onError:e=>{console.error("Failed to create task:",e),E({title:"Error",description:"Failed to create task. Please try again.",variant:"destructive"})}}),T=(0,d.n)({mutationFn:async e=>{let t=await fetch("/api/notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})});if(!t.ok)throw Error("Failed to create note");return t.json()},onSuccess:()=>{D.invalidateQueries({queryKey:["notes"]}),E({title:"Note created",description:"Your note has been created successfully."})}}),R=(0,a.useCallback)(async e=>{if(!x.trim()&&!e&&k)return;h(!0);let t=e||x||"";w(""),t&&m(e=>[...e,{role:"user",content:t}]);try{if(k&&t.trim()){let e=t.match(/#task\s+(.+)/),n=t.match(/#note\s+(.+)/);if(e){console.log("Creating task from user message:",e[1]),await A.mutateAsync(e[1]);return}if(n){console.log("Creating note from user message:",n[1]),await T.mutateAsync(n[1]);return}}let e=await o(t,k,N,I,j);if(e.success&&e.data){!k&&e.data.onboardingStep&&(S(e.data.onboardingStep),e.data.setupComplete&&C({userName:t,agentName:"Toby"}));let n=e.data.data||"";m(e=>[...e,{role:"assistant",content:n}])}else throw Error(e.error||"Failed to get AI response")}catch(e){console.error("Error processing message:",e),E({title:"Error",description:"Failed to process your message. Please try again.",variant:"destructive"})}finally{h(!1)}},[x,k,N,S,C,A,T,E,I,j]),q=(0,a.useCallback)(async e=>{if(!x.trim()&&!e&&k)return;h(!0),y("");let t=e||x||"";w(""),t&&m(e=>[...e,{role:"user",content:t}]);try{var n;if(k&&t.trim()){console.log("STREAMING: Checking message for hashtags:",t);let e=t.match(/#task\s+(.+)/),n=t.match(/#note\s+(.+)/);if(console.log("STREAMING: Task match result:",e),console.log("STREAMING: Note match result:",n),e){console.log("STREAMING: Creating task from user message:",e[1]),await A.mutateAsync(e[1]);return}if(n){console.log("STREAMING: Creating note from user message:",n[1]),await T.mutateAsync(n[1]);return}}let e=new AbortController;v.current=e;let r=await fetch("/api/ai/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t,hasSeenOnboarding:k,userName:I,agentName:j}),signal:e.signal});if(!r.ok)throw Error("Failed to get streaming response");let a=null==(n=r.body)?void 0:n.getReader(),o=new TextDecoder,s=-1;if(a)for(;;){let{done:e,value:t}=await a.read();if(e)break;for(let e of o.decode(t).split("\n").filter(e=>e.trim()))try{let t=JSON.parse(e);switch(t.type){case"thinking":y(t.content);break;case"content":-1===s?m(e=>{let n=[...e,{role:"assistant",content:t.content,isStreaming:!0}];return s=n.length-1,n}):m(e=>{let n=[...e];return n[s]={...n[s],content:t.fullContent||n[s].content+t.content},n});break;case"complete":m(e=>{let n=[...e];return s>=0&&(n[s]={...n[s],content:t.fullContent,isStreaming:!1}),n});break;case"error":throw Error(t.content)}}catch(e){console.warn("Failed to parse streaming chunk:",e)}}}catch(e){"AbortError"===e.name?(console.log("Message cancelled by user"),E({title:"Message cancelled",description:"The message was cancelled."})):(console.error("Error processing streaming message:",e),E({title:"Error",description:"Failed to process your message. Please try again.",variant:"destructive"}))}finally{h(!1),y(""),v.current=null}},[x,k,I,j,A,T,E]),Q=(0,a.useCallback)(()=>{b(e=>!e)},[]),M=(0,a.useCallback)(()=>{v.current&&v.current.abort()},[]),P=!!(v.current&&f),O=(0,a.useCallback)(()=>{u(!0),0===p.length&&(k?m([{role:"assistant",content:"Welcome back! What can I help you with?"}]):R(""))},[k,R,p]),z=(0,a.useCallback)(()=>{u(!1)},[]);return(0,a.useEffect)(()=>{let e=e=>{e.metaKey&&"k"===e.key&&(e.preventDefault(),u(e=>!e))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(0,r.jsx)(c.Provider,{value:{isChatOpen:n,setIsChatOpen:u,openChat:O,closeChat:z,messages:p,setMessages:m,isThinking:f,thinkingContent:g,inputValue:x,setInputValue:w,processMessage:R,processStreamingMessage:q,isStreamingMode:_,toggleStreamingMode:Q,cancelMessage:M,canCancel:P},children:t})}function p(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useChatContext must be used within a ChatProvider");return e}},82180:(e,t,n)=>{"use strict";n.d(t,{Bc:()=>d,ZI:()=>p,k$:()=>u,m_:()=>c});var r=n(95155),a=n(12115),o=n(47520),s=n(25016),i=n(39783),l=n.n(i);let d=o.Kq,c=o.bL,u=o.l9,p=a.forwardRef((e,t)=>{let{className:n,sideOffset:a=4,...i}=e;return(0,r.jsx)(o.UC,{ref:t,sideOffset:a,className:(0,s.cn)(l().content,n),...i})});p.displayName=o.UC.displayName},88219:e=>{e.exports={container:"shiny-ai-button_container__qGMG2",iconContainer:"shiny-ai-button_iconContainer__fTvX5"}},97113:(e,t,n)=>{"use strict";n.d(t,{t:()=>o});var r=n(25959),a=n(89863);let o=(0,r.v)()((0,a.Zr)(e=>({isInitialized:!1,userName:"there",agentName:"Alex",hasSeenOnboarding:!1,onboardingStep:null,setUserName:t=>e({userName:t}),setAgentName:t=>e({agentName:t}),finishInitialization:()=>e({isInitialized:!0}),setOnboardingStep:t=>e({onboardingStep:t}),completeOnboarding:t=>e({hasSeenOnboarding:!0,onboardingStep:null,userName:t.userName,agentName:t.agentName})}),{name:"agent-settings",storage:(0,a.KU)(()=>localStorage),partialize:e=>({userName:e.userName,agentName:e.agentName,isInitialized:e.isInitialized,hasSeenOnboarding:e.hasSeenOnboarding})}))},97450:(e,t,n)=>{"use strict";n.d(t,{AM:()=>i,Wv:()=>l,hl:()=>d});var r=n(95155),a=n(12115),o=n(82286),s=n(25016);let i=o.bL,l=o.l9;o.Mz;let d=a.forwardRef((e,t)=>{let{className:n,align:a="center",sideOffset:i=4,...l}=e;return(0,r.jsx)(o.ZL,{children:(0,r.jsx)(o.UC,{ref:t,align:a,sideOffset:i,className:(0,s.cn)("z-[200] w-72 rounded-xl border border-[#252525] bg-[#1a1a1a] p-0 text-white shadow-lg outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",n),...l})})});d.displayName=o.UC.displayName}}]);