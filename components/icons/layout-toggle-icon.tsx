'use client'

import { useEffect, useRef } from 'react'

interface LayoutToggleIconProps {
  isToggled: boolean
  size?: number
  className?: string
}

export function LayoutToggleIcon({ isToggled, size = 16, className = '' }: LayoutToggleIconProps) {
  const svgRef = useRef<SVGSVGElement>(null)
  const prevToggledRef = useRef(isToggled)

  useEffect(() => {
    if (!svgRef.current || prevToggledRef.current === isToggled) return
    
    prevToggledRef.current = isToggled
    
    const animates = svgRef.current.querySelectorAll('animate')
    animates.forEach(animate => {
      const element = animate as SVGAnimateElement
      
      // Set direction based on toggle state
      if (isToggled) {
        // Play forward (two-row to single-row)
        element.setAttribute('values', element.getAttribute('data-values') || '')
        element.beginElement()
      } else {
        // Play backward (single-row to two-row) - reverse the values
        const values = element.getAttribute('data-values') || ''
        const reversed = values.split(';').reverse().join(';')
        element.setAttribute('values', reversed)
        element.beginElement()
      }
    })
  }, [isToggled])

  return (
    <svg 
      ref={svgRef}
      xmlns="http://www.w3.org/2000/svg" 
      width={size} 
      height={size} 
      viewBox="0 0 16 16"
      className={className}
    >
      <path 
        d="M 2 9 H 5 A 2 2 0 0 1 7 11 V 14 A 2 2 0 0 1 5 16 H 2 A 2 2 0 0 1 0 14 V 11 A 2 2 0 0 1 2 9 Z" 
        fill="currentColor"
      >
        <animate
          attributeName="d"
          keyTimes="0; 1.0"
          data-values="M2 9C3 9,4 9,5 9C6.1045694996615865 9,7 9.895430500338414,7 11C7 12,7 13,7 14C7 15.104569499661586,6.1045694996615865 16,5 16C4 16,3 16,2 16C0.8954305003384135 16,1.3527075021963556e-16 15.104569499661586,0 14C0 13,0 12,0 11C-1.3527075021963556e-16 9.895430500338414,0.8954305003384133 9,2 9Z;M0.001963160682933452 0.0030078C1.16848293657357 0.0030078,2.33496893164212 0.0030078,3.5014763069778136 0.0030078C4.66806920338208 0.0030078,5.834480367515629 0.004009390000000001,7.000025630829875 0.005257549999999999C7.000025630829875 1.33805,7.000025630829875 2.67086,7.000025630829875 4.00356C7.000025630829875 5.33645,6.999127659609859 6.6692,6.998122787054126 8.00081C5.8315940314512895 8.00081,4.665086656115597 8.00081,3.49855790051276 8.00081C2.3319650041084934 8.00081,1.1655645301085162 7.99981,0.000030624099077035865 7.99852C0.000030624099077035865 6.66581,0.000030624099077035865 5.33304,0.000030624099077035865 4.00023C0.000030624099077035865 2.66732,0.000898174299087407 1.33463,0.001963160682933452 0.0030078Z"
          values="M2 9C3 9,4 9,5 9C6.1045694996615865 9,7 9.895430500338414,7 11C7 12,7 13,7 14C7 15.104569499661586,6.1045694996615865 16,5 16C4 16,3 16,2 16C0.8954305003384135 16,1.3527075021963556e-16 15.104569499661586,0 14C0 13,0 12,0 11C-1.3527075021963556e-16 9.895430500338414,0.8954305003384133 9,2 9Z;M0.001963160682933452 0.0030078C1.16848293657357 0.0030078,2.33496893164212 0.0030078,3.5014763069778136 0.0030078C4.66806920338208 0.0030078,5.834480367515629 0.004009390000000001,7.000025630829875 0.005257549999999999C7.000025630829875 1.33805,7.000025630829875 2.67086,7.000025630829875 4.00356C7.000025630829875 5.33645,6.999127659609859 6.6692,6.998122787054126 8.00081C5.8315940314512895 8.00081,4.665086656115597 8.00081,3.49855790051276 8.00081C2.3319650041084934 8.00081,1.1655645301085162 7.99981,0.000030624099077035865 7.99852C0.000030624099077035865 6.66581,0.000030624099077035865 5.33304,0.000030624099077035865 4.00023C0.000030624099077035865 2.66732,0.000898174299087407 1.33463,0.001963160682933452 0.0030078Z"
          dur="0.6s"
          fill="freeze"
          calcMode="spline"
          keySplines="0.34 1.56 0.64 1"
        />
      </path>
      
      <rect 
        fill="currentColor" 
        x="9" 
        y="0" 
        width="7" 
        height="7" 
        rx="2" 
        ry="2"
      />
      
      <path 
        d="M 2 0 H 5 A 2 2 0 0 1 7 2 V 5 A 2 2 0 0 1 5 7 H 2 A 2 2 0 0 1 0 5 V 2 A 2 2 0 0 1 2 0 Z" 
        fill="currentColor"
      >
        <animate
          attributeName="d"
          keyTimes="0; 1.0"
          data-values="M2 0C3 0,4 0,5 0C6.1045694996615865 6.763537510981778e-17,7 0.8954305003384133,7 2C7 3,7 4,7 5C7 6.1045694996615865,6.1045694996615865 7,5 7C4 7,3 7,2 7C0.8954305003384135 7,1.3527075021963556e-16 6.1045694996615865,0 5C0 4,0 3,0 2C-1.3527075021963556e-16 0.8954305003384135,0.8954305003384133 2.0290612532945332e-16,2 0Z;M8.998259773373604 0C10.164911497831344 0,11.331523211598396 0,12.49823495209217 0C13.664846665859223 3.1828699999999994e-20,14.831158299446106 0.00042134000000000003,15.997369906306266 0.000941203C15.997369906306266 1.33419,15.997369906306266 2.66743,15.997369906306266 4.0007C15.997369906306266 5.33398,15.996969799399377 6.66719,15.996469665765762 7.99997C14.829857951998711 7.99997,13.663546318411827 7.99997,12.496834577918053 7.99997C11.330222864151 7.99997,10.163511123657226 7.99953,8.997389540851115 7.99901C8.997389540851115 6.66578,8.997389540851115 5.33252,8.997389540851115 3.99927C8.997389540851115 2.66599,8.997779645085336 1.33278,8.998259773373604 0Z"
          values="M2 0C3 0,4 0,5 0C6.1045694996615865 6.763537510981778e-17,7 0.8954305003384133,7 2C7 3,7 4,7 5C7 6.1045694996615865,6.1045694996615865 7,5 7C4 7,3 7,2 7C0.8954305003384135 7,1.3527075021963556e-16 6.1045694996615865,0 5C0 4,0 3,0 2C-1.3527075021963556e-16 0.8954305003384135,0.8954305003384133 2.0290612532945332e-16,2 0Z;M8.998259773373604 0C10.164911497831344 0,11.331523211598396 0,12.49823495209217 0C13.664846665859223 3.1828699999999994e-20,14.831158299446106 0.00042134000000000003,15.997369906306266 0.000941203C15.997369906306266 1.33419,15.997369906306266 2.66743,15.997369906306266 4.0007C15.997369906306266 5.33398,15.996969799399377 6.66719,15.996469665765762 7.99997C14.829857951998711 7.99997,13.663546318411827 7.99997,12.496834577918053 7.99997C11.330222864151 7.99997,10.163511123657226 7.99953,8.997389540851115 7.99901C8.997389540851115 6.66578,8.997389540851115 5.33252,8.997389540851115 3.99927C8.997389540851115 2.66599,8.997779645085336 1.33278,8.998259773373604 0Z"
          dur="0.6s"
          fill="freeze"
          calcMode="spline"
          keySplines="0.34 1.56 0.64 1"
        />
      </path>
      
      <path 
        d="M 11 9 H 14 A 2 2 0 0 1 16 11 V 14 A 2 2 0 0 1 14 16 H 11 A 2 2 0 0 1 9 14 V 11 A 2 2 0 0 1 11 9 Z" 
        fill="currentColor"
      >
        <animate
          attributeName="d"
          keyTimes="0; 1.0"
          data-values="M11 9C12 9,13 9,14 9C15.104569499661586 9,16 9.895430500338414,16 11C16 12,16 13,16 14C16 15.104569499661586,15.104569499661586 16,14 16C13 16,12 16,11 16C9.895430500338414 16,9 15.104569499661586,9 14C9 13,9 12,9 11C9 9.895430500338414,9.895430500338414 9,11 9Z;M0.00432591 9.93268C2.67034 9.93268,5.33634 9.93268,8.00236 9.93268C10.6683 9.93268,13.3345 9.93301,16 9.93337C16 10.9446,16 11.9557,16 12.9669C16 13.9781,15.9996 14.9893,15.9992 16C13.3333 16,10.6671 16,8.00116 16C5.33513 16,2.66915 15.9997,0.0035399 15.9992C0.0035399 14.9881,0.0035399 13.9769,0.0035399 12.9657C0.0035399 11.9545,0.00389115 10.9434,0.00432591 9.93268Z"
          values="M11 9C12 9,13 9,14 9C15.104569499661586 9,16 9.895430500338414,16 11C16 12,16 13,16 14C16 15.104569499661586,15.104569499661586 16,14 16C13 16,12 16,11 16C9.895430500338414 16,9 15.104569499661586,9 14C9 13,9 12,9 11C9 9.895430500338414,9.895430500338414 9,11 9Z;M0.00432591 9.93268C2.67034 9.93268,5.33634 9.93268,8.00236 9.93268C10.6683 9.93268,13.3345 9.93301,16 9.93337C16 10.9446,16 11.9557,16 12.9669C16 13.9781,15.9996 14.9893,15.9992 16C13.3333 16,10.6671 16,8.00116 16C5.33513 16,2.66915 15.9997,0.0035399 15.9992C0.0035399 14.9881,0.0035399 13.9769,0.0035399 12.9657C0.0035399 11.9545,0.00389115 10.9434,0.00432591 9.93268Z"
          dur="0.6s"
          fill="freeze"
          calcMode="spline"
          keySplines="0.34 1.56 0.64 1"
        />
      </path>
    </svg>
  )
}
